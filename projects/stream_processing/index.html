<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="自是白衣卿相的博客" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="自是白衣卿相的博客" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="自是白衣卿相的博客" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="强化学习,流处理,Kafka,Zookeeper,Spark"><link rel="canonical" href="http://example.com/projects/stream_processing/"><title>用深度强化学习实时预测和交易加密货币 - 科研项目 | Miracle = 自是白衣卿相的博客</title><meta name="generator" content="Hexo 7.1.1"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">用深度强化学习实时预测和交易加密货币</h1><div class="meta"><span class="item" title="创建时间：2022-05-08 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-05-08T00:00:00+08:00">2022-05-08</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>12k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>11 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Miracle</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://miraclelinzzz.github.io/assets/cover/stream.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/projects/" itemprop="item" rel="index" title="分类于 科研项目"><span itemprop="name">科研项目</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/projects/stream_processing/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Miralce"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="自是白衣卿相的博客"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>可以在此处找到项目的原代码 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01pcmFjbGVMaW56enovS2Fma2FSZWFsVGltZUNyeXB0b2N1cnJlbmN5">📍链接</span></p></div><h1 id="背景介绍-瞎鸡儿凑字数"><a class="anchor" href="#背景介绍-瞎鸡儿凑字数">#</a> 背景介绍 <s>(瞎鸡儿凑字数)</s></h1><h2 id="为什么要用强化学习"><a class="anchor" href="#为什么要用强化学习">#</a> 为什么要用强化学习？</h2><p>股票交易是一种优先考虑短期利润而不是长期回报的投资形式。因此，在进行股票交易时，有必要具备专业知识。大多数股票投资者都知道基本面分析中最常用的财务数据。在此分析的基础上，他们可以进行量化交易。</p><p>近年来，越来越多的公司试图利用人工智能来建立<span class="red">机器学习模型</span>，以此来改进他们的交易策略。</p><p>在我们的项目中，我们在股票市场的背景下，建立了<span class="red">强化学习模型</span>，对比特币的交易进行实时决策。</p><p>股票市场包括历史价格序列和走势，可以看作是一个复杂的环境。我们的目标是培养一个能自己对买入和卖出股票做决定的代理单元。因此，<span class="red">强化学习算法</span>可以有效地解决这个问题。</p><p>强化学习的目的是优化累积的未来奖励信号，以便为序列选择问题制定适当的策略。在研究了部分金融投资组合管理问题的深度强化学习框架后，发现部分 Q 学习算法，如</p><ul><li><span class="red">异步优势演员 - 评论家算法</span> (Asynchronous Advantage Actor-Critical, A3C)</li><li><span class="red">信赖域策略优化算法</span> (Trust Region Policy Optimization, TRPO)</li></ul><p>在某些条件下存在明显高估的动作价值，继而影响最终的性能。相比之下，<span class="red">DQN</span> (Deep Q-network) 通过将 Q 学习与深度神经网络相结合来解决这些问题，不仅减少了观察到的高估值，而且在一些博弈理论上显著地提高了性能。</p><h2 id="为什么要用流处理"><a class="anchor" href="#为什么要用流处理">#</a> 为什么要用流处理</h2><p>在传统的投资组合管理问题中使用流处理的原因是为了解决两个重要的量化交易问题:</p><ul><li>数据数量上的短缺</li><li>数据本身质量低</li></ul><p>金融数据信息处理需要从海量的噪声中提取有意义的数据。由于金融市场上存在大量的噪音，人们最朴素期待的结果就是自己做出的决策事正确决策的概率大于 50%。</p><p>但事实总是不尽人意，通常来说，基于以往有限样本的旧数据进行的预测研究往往很难达到令人接受的程度。</p><p>故，金融和经济学领域的强化学习研究通常不会在 “大数据” 背景下进行。</p><p>为了解决上述问题，使我们的系统具有更现实的意义和更多的商业价值，我们构建了一个集成深度强化学习模型和 Kafka 流处理方法的系统，来获取和处理实时股票数据。可以同时处理多种加密货币数据。</p><p><img data-src="/assets/stream_processing/image.png" alt="&quot;深度强化学习(DRL)模型&quot;" title="深度强化学习(DRL)模型"></p><h1 id="强化学习模型"><a class="anchor" href="#强化学习模型">#</a> 强化学习模型</h1><p>强化学习训练的一个重要步骤是 Q 值表的更新，其中 Bellman 方程起着至关重要的作用。Bellman 方程的主要思想是利用下一个状态信息 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">v_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.638891em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span> 得到当前状态的 Q 值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Q</mi><mi>π</mi></msub><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>E</mi><mi>π</mi></msub><mo stretchy="false">[</mo><msub><mi>R</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>γ</mi><msub><mi>Q</mi><mi>π</mi></msub><mo stretchy="false">(</mo><msub><mi>S</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>A</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><msub><mi>S</mi><mi>t</mi></msub><mo>=</mo><mi>s</mi><mo separator="true">,</mo><msub><mi>A</mi><mi>t</mi></msub><mo>=</mo><mi>a</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">Q_{\pi}(s,a) = E_{\pi}[R_{t+1}+\gamma Q_{\pi}(S_{t+1},A_{t+1})|S_t = s,A_t = a]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:-.00773em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05556em">γ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.8777699999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">a</span><span class="mclose">]</span></span></span></span></span></p><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>π</mi></msub><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q_{\pi}(s,a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span> 是基于当前状态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">s</span></span></span></span> 和遵循策略 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03588em">π</span></span></span></span> 的动作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">a</span></span></span></span> 的 Q 值。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>π</mi></msub><mo stretchy="false">(</mo><msub><mi>S</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>A</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q_{\pi}(S_{t+1},A_{t+1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 是下一个状态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.638891em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span> 和此状态下的动作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">a_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.638891em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span> 给出的 Q 值。 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">R_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.891661em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:-.00773em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span> 表示下一刻的奖励。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05556em">γ</span></span></span></span> 是从 0 到 1 的折扣因子</p><p>DQN 中有 2 个神经网络，其中一个是策略网络，另一个是价值网络，它可以将状态映射到 (动作，Q 值) 对。在 DQN 训练中，更新神经网络权值时，Bellman 方程起着重要的作用</p><p>DQN 的核心部分是嵌入式 CNN 模型。对于我们项目中的状态空间，7 个技术指标用来表示状态环境:<br><span class="label primary">平衡</span><span class="label primary">价格</span><span class="label primary">股票</span><span class="label primary"> MACD</span><span class="label primary">RSI</span><span class="label primary">CCI</span><span class="label primary">ADX</span><br>在每次状态迭代中，Q 值表都会被更新，agent 代理可以根据这些信息学习相应的策略</p><p>对于训练和测试数据，我们使用了 2015-2022 年的 Kaggle 开源 candle chart 数据，包括 BTCUSDT 和 Ethusdt 的<span class="label primary">开盘价</span><span class="label primary">高点</span><span class="label primary">低点</span><span class="label primary">收盘价</span>。由于加密货币每周 7 天，每天 24 小时运行，因此我们的输入数据为 5GB 的 7 年数据</p><p><img data-src="/assets/stream_processing/data.png" alt="数据" title="数据集"></p><p>7 年票证数据除了量大、处理资源需求大之外，还包含了大量 2018-2021 年不需要的动荡数据和长期牛市数据，这可能会影响我们模型的训练结果</p><p>我们选择了几个典型的时间段进行综合整合，包括牛市，熊市和高动荡市场 (2017 - 2018,2019 - 2020,2020-2021)。价格历史数据集标记良好、并预先格式化</p><p>为了提高网络收敛的速度，我们将数据归一化 (0 到 1 之间)。然后我们用模型进行了几次训练试验，但结果并不令人满意。我们认为，仅仅使用原始的价格数据可能不够充分。技术指标可能比价格数据能够为市场提供更多的信息。因此，我们决定将其包含在我们的数据集中，以提高模型的性能。</p><p>RSI、MACD 和 BRAR 技术指标是根据我们从 kaggle 收到的原始数据，使用 technical-indicators-lib 生成的</p><p><img data-src="/assets/stream_processing/result.png" alt="结果" title="模型结果"></p><p>我们对模型的超参数进行了微调。使用了 ReLU 和 Adam。用 Btcusdt 历史数据 (2017 - 2018,2019 - 2020,2020-2021) 来训练模型，2022.01 至 2022.04 来测试预训练的模型。我们将初始收益定为 100 万美元。</p><p>这种策略每天交易约 18 次。曲线如下图所示：最大 draw down 为 8％，年收益率为 30％，sharpe ratio 为 2.6。上图显示了利润与交易时间的关系</p><h1 id="流处理操作流程"><a class="anchor" href="#流处理操作流程">#</a> 流处理操作流程</h1><p>一旦我们导出了经过训练的强化学习模型，我们就可以通过一系列技术工具构建应用程序来获得实时预测结果。 如下图所示</p><p><img data-src="/assets/stream_processing/flowchart.png" alt="&quot;总体技术栈流程图&quot;" title="总体技术栈流程图"></p><p>整个项目流程图可以简单地分为几个部分，包括</p><ul><li>数据采集与流数据转换</li><li>流数据处理</li><li>流数据预测</li><li>数据可视化</li></ul><h2 id="环境配置准备"><a class="anchor" href="#环境配置准备">#</a> 环境配置准备</h2><p>建议使用 Anaconda 创建虚拟环境<br><code>conda create -n your_env_name python=x.x</code></p><p>在虚拟环境中安装相应依赖</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">keras==2.3.1</span><br><span class="line">tensorflow==1.14.0</span><br><span class="line">pandas==0.24.2</span><br><span class="line">numpy==1.16.1</span><br><span class="line">tqdm==4.24.0</span><br><span class="line">docopt==0.6.2</span><br><span class="line">coloredlogs==10.0</span><br><span class="line">jupyterlab==1.0.1</span><br><span class="line">altair==4.0.0</span><br><span class="line">seaborn==0.9.0</span><br><span class="line"></span><br><span class="line">cryptocompare</span><br><span class="line">matplotlib</span><br></pre></td></tr></table></figure><p><code>pip install -r requirement.txt</code></p><h2 id="流处理软件初始化"><a class="anchor" href="#流处理软件初始化">#</a> 流处理软件初始化</h2><div class="note warning"><p>这个项目是在个人电脑上运行的 demo，Windows 11 系统。实际运行可能在云平台或虚拟机 Linux 上效果更加，配置操作相应变化。</p></div><p>Kafka 依赖 ZooKeeper 作为分布式系统提供协调服务的工具，在启动 Kafka 服务前需要先启动 ZooKeeper 服务。<br>新版本 Kafka 内置了 ZooKeeper 服务（Kafka 2.8 之后），所以我们可以有两种 ZooKeeper 的启动方式<br>一种是单独下载 ZooKeeper，然后配置环境变量、启动服务<br>第二种是启动 Kafka 内置的 ZooKeeper 服务</p><h3 id="单独搭建-zookeeper-环境并启动服务"><a class="anchor" href="#单独搭建-zookeeper-环境并启动服务">#</a> 单独搭建 ZooKeeper 环境并启动服务</h3><ol><li>官网下载：<span class="exturl" data-url="aHR0cHM6Ly96b29rZWVwZXIuYXBhY2hlLm9yZy8=">https://zookeeper.apache.org/</span></li><li>选择自己需要的版本，下载压缩包（本项目是 3.6.3 版本）</li><li>将压缩包存放在磁盘某位置，路径无中文</li><li>在 ZooKeeper 的解压缩目录中，找到 conf 文件夹，该文件夹包含了 ZooKeeper 的配置文件。复制 “zoo_sample.cfg&quot;这个文件，重命名为&quot;zoo.cfg”，修改相应配置项，如<ul><li>dataDir：指定 ZooKeeper 存储数据的目录，默认为 /tmp/zookeeper</li><li>dataLogDir：指定 ZooKeeper 存储日志的目录</li><li>clientPort：指定客户端连接到 ZooKeeper 服务器的端口号，默认为 2181</li><li>tickTime：指定 ZooKeeper 服务器之间的心跳间隔时间（以毫秒为单位），默认为 2000</li></ul></li><li>创建需要的 data 和 logs 文件夹在相应目录，也可以在 cmd 命令行里全局指定地址，如</li></ol><figure class="highlight shell"><figcaption><span>mark:1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set ZOOKEEPER_LOGS_PATH=C:\tmp\zookeeper</span><br></pre></td></tr></table></figure><ol start="6"><li>编辑 path 系统变量，添加路径 <code>%ZOOKEEPER_HOME%\bin</code> ，ZOOKEEPER_HOME 为文件夹路径</li><li>打开 cmd 命令窗口，输入 zkServer，启动 ZooKeeper 服务。关闭窗口则结束服务</li></ol><h3 id="下载kafka"><a class="anchor" href="#下载kafka">#</a> 下载 Kafka</h3><ol><li>官网下载：<span class="exturl" data-url="aHR0cDovL2thZmthLmFwYWNoZS5vcmcvZG93bmxvYWRz">http://kafka.apache.org/downloads</span></li><li>选择自己需要的版本，下载压缩包（本项目是 2.12-3.1.0 版本）</li></ol><h3 id="启动kafka内置的zookeeper服务"><a class="anchor" href="#启动kafka内置的zookeeper服务">#</a> 启动 Kafka 内置的 ZooKeeper 服务</h3><ol><li>将压缩包存放在磁盘某位置，路径无中文，新建 data 文件夹</li><li>进入 &quot;config&quot; 目录，用编辑软件打开 &quot;zookeeper.properties&quot; 文件，修改 &quot;dataDir&quot;</li><li>打开 cmd 命令窗口，进入 Kafka 解压包根目录，输入命令行启动 Kafka 内置的 ZooKeeper 服务。关闭 cmd 窗口即关闭服务</li></ol><figure class="highlight shell"><figcaption><span>mark:1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\bin\windows\zookeeper-server-start.bat .\config\zookeeper.properties</span><br></pre></td></tr></table></figure><p><img data-src="/assets/stream_processing/zookeeper.png" alt="Start and initialize Zookeeper" title="ZooKeeper启动成功"></p><h3 id="启动kafka"><a class="anchor" href="#启动kafka">#</a> 启动 Kafka</h3><ol><li>在 Kafka 解压包根目录下新建 &quot;kafka-logs&quot; 文件夹</li><li>进入 &quot;config&quot; 目录，用编辑软件打开 &quot;server.properties&quot; 文件，找到 &quot;log.dirs&quot; 配置，将其路径设置为我们新建的 &quot;kafka-logs&quot; 目录的路径。如果有修改 ZooKeeper 服务的默认端口或 ip, 可以同时编辑 “zookeeper.connect”，更改 ZooKeeper 服务的 ip 和端口号配置</li><li>打开 cmd 命令窗口，进入 Kafka 解压包根目录下，输入命令行，启动 Kafka。关闭 cmd 窗口即关闭服务</li></ol><figure class="highlight shell"><figcaption><span>mark:1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\bin\windows\kafka-server-start.bat .\config\server.properties</span><br></pre></td></tr></table></figure><p><img data-src="/assets/stream_processing/kafka.png" alt="Start and initialize Kafka" title="Kafka启动成功"></p><details class="warning"><summary>可能存在的报错</summary><div><ul><li><p>端口占用<br>可以用 <code>netstat -ano | findstr 2181</code> 找到占用端口的 pid，然后用 <code>taskkill /f /pid pid号</code> 关闭即可</p></li><li><p>Kafka 执行完就 shutting down<br>可能是 Kafka 集群 id 跟元数据 &quot;meta.properties&quot; 中存储的不一致，导致启动失败。只需要将 Kafka 配置文件 &quot;server.properties&quot; 中 &quot;log.dirs&quot; 配置的 &quot;kafka-logs&quot; 目录下的文件全部删除，重新执行 Kafka 的启动命令即可。ZooKeeper 同理</p></li><li><p>timeindex.cleaned 另一个程序正在使用此文件，进程无法访问<br>可能由于非正常关闭 Kafka, 导致其无法完成对日志文件完成解锁。将 &quot;kafka-logs&quot; 路径下的文件全部删除重启即可</p></li><li><p>目录层级太深或者是目录名字太长可能导致启动失败</p></li></ul></div></details><div class="note danger"><p>Kafka 和 Spark Dstream 之间的版本问题:</p><ul><li>Spark 2.4 之后，没有针对 Spark Streaming 的更新（已弃用），这意味着两者之间没有 API。<br><code>from pyspark.streaming.kafka import KafkaUtils</code></li><li>Structured Streaming 成为主流流处理数据结构</li><li>需要一个配置文件用于连接 Kafka 和 Spark Streaming，他的版本也关系到能否起到兼容效果。</li><li>此外还有需要注意的有<ul><li>Py4J 的兼容性问题</li><li>Java JDK 的兼容性问题</li><li>高版本 Python 的兼容性问题</li></ul></li></ul><figure class="highlight python"><figcaption><span>mark:1-3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java8_location = <span class="string">&#x27;%JAVA_HOME%\Java\jdk1.8.0_331&#x27;</span> </span><br><span class="line">os.environ[<span class="string">&#x27;JAVA_HOME&#x27;</span>] = java8_location</span><br><span class="line">os.environ[<span class="string">&#x27;PYSPARK_SUBMIT_ARGS&#x27;</span>] = <span class="string">&#x27;--jars spark-streaming-kafka-0-8-assembly_2.11-2.1.1.jar pyspark-shell&#x27;</span></span><br></pre></td></tr></table></figure></div><p>使用 <span class="red">Cryptocompare API</span> 来获取指定加密货币的实时价格以及相应的其他附加信息。原始数据以 <code>&#123;name, currency, amount, time&#125;</code> （加密货币名，对标货币名，货币量，时间）的字典形式打包</p><p>我们定义并初始化多个 Kafka 生产者，不同的价格信息将按其不同主题（其加密货币名称）分隔并存储在 Broker 上（这个 Broker 依赖 ZooKeeper 的分布式存储）。并发送日志记录当前实时数据情况</p><figure class="highlight python"><figcaption><span>生产者</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">initProducer</span>():</span><br><span class="line">    <span class="comment"># init an instance of KafkaProducer</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Initializing Kafka producer at &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(time.time()))</span><br><span class="line">    producer = KafkaProducer(bootstrap_servers=config[<span class="string">&#x27;kafka_broker&#x27;</span>], api_version=(<span class="number">0</span>,<span class="number">11</span>,<span class="number">5</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Initialized Kafka producer at &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(time.time()))</span><br><span class="line">    <span class="keyword">return</span> producer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">produceRecord</span>(<span class="params">data, producer, topic, partition=<span class="number">0</span></span>):</span><br><span class="line">    <span class="comment"># act as a producer sending records on kafka</span></span><br><span class="line">    producer.send(topic=topic, partition=partition, value=<span class="built_in">bytes</span>(<span class="built_in">str</span>(data), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment"># debug \ message in prompt</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Produce record to topic \&#x27;&#123;0&#125;\&#x27; at time &#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(topic, time.time()))</span><br></pre></td></tr></table></figure><p>Broker 充当生产者和消费者之间信息的渠道。 在这个过程中，所有这些组件都需要向 Zookeeper 注册。 Kafka 集群使用 Zookeeper 来管理 Kafka 配置并选举领导者。 所有主题和代理之间的映射由 Zookeeper 维护。 而当 Consumer Group 发生变化时，就会进行重新平衡。 由于我们仅在一台 PC 上运行演示，因此未应用分区配置。</p><p><img data-src="/assets/stream_processing/kafka1.png" alt="" title="生产者消费者运行示意图"></p><figure class="highlight python"><figcaption><span>消费者</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">initConsumer</span>(<span class="params">topic, timeout=<span class="number">1000</span></span>):</span><br><span class="line">    <span class="comment"># init an instance of KafkaConsumer</span></span><br><span class="line">    consumer = KafkaConsumer(topic, api_version=(<span class="number">0</span>,<span class="number">11</span>,<span class="number">5</span>), bootstrap_servers=config[<span class="string">&#x27;kafka_broker&#x27;</span>], group_id=<span class="literal">None</span>,</span><br><span class="line">        auto_offset_reset=<span class="string">&#x27;earliest&#x27;</span>, enable_auto_commit=<span class="literal">False</span>, consumer_timeout_ms=timeout)</span><br><span class="line">    <span class="keyword">return</span> consumer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">produceRecord</span>(<span class="params">data, producer, topic, partition=<span class="number">0</span></span>):</span><br><span class="line">    <span class="comment"># act as a producer sending records on kafka</span></span><br><span class="line">    producer.send(topic=topic, partition=partition, value=<span class="built_in">bytes</span>(<span class="built_in">str</span>(data), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment"># debug \ message in prompt</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Produce record to topic \&#x27;&#123;0&#125;\&#x27; at time &#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(topic, time.time()))</span><br></pre></td></tr></table></figure><h3 id="spark-dstream-流处理"><a class="anchor" href="#spark-dstream-流处理">#</a> Spark Dstream 流处理</h3><p>Spark 作为 Consumer 获取 Broker 中的数据并转化为 Dstream。</p><figure class="highlight python"><figcaption><span>Spark初始化</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sc = SparkContext() </span><br><span class="line"><span class="comment"># sc.setLogLevel(&#x27;INFO&#x27;)</span></span><br><span class="line">ssc = StreamingContext(sc, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># Instantiate a kafka stream for processing.</span></span><br><span class="line">directKafkaStream = KafkaUtils.createDirectStream(ssc, [config[<span class="string">&#x27;topic_1&#x27;</span>]], &#123;<span class="string">&#x27;metadata.broker.list&#x27;</span>:config[<span class="string">&#x27;kafka_broker&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><p>假设有几个用时间序列号标记的 Dstream。 为了消除由于我们获取高频数据而产生的异常干扰，我们设置了一个过滤操作来选择合格的候选者。原始 Dstream 被复制，以便一旦有新数据进来，就会与前一个数据进行比较。 如果它们之间的值差小于 3%，则可以允许进行进一步的操作，否则将被弃用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">data = []</span><br><span class="line">time_get = []</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Starting Apache Kafka consumers and producer&#x27;</span>)</span><br><span class="line">consumer_1 = initConsumer(config[<span class="string">&#x27;topic_1&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">len</span>(data)&lt;<span class="number">15</span>):</span><br><span class="line">    records_1 = consumeRecord(consumer_1)</span><br><span class="line">    <span class="keyword">for</span> record <span class="keyword">in</span> records_1:</span><br><span class="line">        strings = time.strftime(<span class="string">&quot;%Y,%m,%d,%H,%M,%S&quot;</span>, time.localtime(record[<span class="string">&quot;time&quot;</span>]))</span><br><span class="line">        t = strings.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        numbers = [t[<span class="number">4</span>], t[<span class="number">5</span>]]</span><br><span class="line">        time_get.append(<span class="built_in">str</span>(numbers[<span class="number">0</span>]) + <span class="string">&#x27;-&#x27;</span> + <span class="built_in">str</span>(numbers[<span class="number">1</span>]))</span><br><span class="line">        <span class="comment"># time.sleep(1)</span></span><br><span class="line">        data.append(record[<span class="string">&quot;amount&quot;</span>])</span><br><span class="line"></span><br><span class="line">initial_offset = data[<span class="number">1</span>] - data[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>经过初步选择后，对 Dstream 进行窗口操作。 窗口长度设置为 15 ，步幅 1。 一旦有新数据进来，旧记录就会消失。 一定程度上解决了数据短缺的问题。处理后的数据将被推送回 Broker，成为一个新的主题。</p><p><img data-src="/assets/stream_processing/stream_operations.png" alt="" title="Spark流处理模块示意"></p><p>随后，该模型将从 Broker 获取数据作为新的 Consumer。 由于模型相对复杂，我们在利用模型进行预测时并没有完全采用流式处理。 我们没有使用 Spark MLlib 中的操作。</p><p>相反，从 Broker 中提取的数据将更改为 DataFrame 并由模型以正常方式读取。 最后，结果会形成折线图显示在前端页面。</p><p>此外，还初始化了另一组 Consumer 来代表不同加密货币的信息，以便在网站上显示价值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.is_websocket():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;websocket connection....&#x27;</span>)</span><br><span class="line">    msg = request.websocket.wait()  <span class="comment"># 接收前端发来的消息</span></span><br><span class="line">    <span class="built_in">print</span>(msg, <span class="built_in">type</span>(msg), json.loads(msg))  <span class="comment"># b&#x27;[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]&#x27; &lt;class &#x27;bytes&#x27;&gt; [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;]</span></span><br><span class="line">    consumer_1 = initConsumer(config[<span class="string">&#x27;topic_1&#x27;</span>])</span><br><span class="line">    consumer_2 = initConsumer(config[<span class="string">&#x27;topic_2&#x27;</span>])</span><br><span class="line">    consumer_3 = initConsumer(config[<span class="string">&#x27;topic_3&#x27;</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> msg:</span><br><span class="line">            records = &#123;&#125;</span><br><span class="line">            records[config[<span class="string">&#x27;topic_1&#x27;</span>]] = consumeRecord(consumer_1)[<span class="number">0</span>]</span><br><span class="line">            records[config[<span class="string">&#x27;topic_2&#x27;</span>]] = consumeRecord(consumer_2)[<span class="number">0</span>]</span><br><span class="line">            records[config[<span class="string">&#x27;topic_3&#x27;</span>]] = consumeRecord(consumer_3)[<span class="number">0</span>]</span><br><span class="line">            request.websocket.send(<span class="built_in">str</span>(records).encode())  <span class="comment"># 向客户端发送数据</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)  <span class="comment"># 每0.5秒发一次</span></span><br></pre></td></tr></table></figure><p>重新整合字典的键后，将通过 WebSocket 传输到前端 HTML。 最后解析为 Json 格式进行可视化。<br><code>from dwebsocket.decorators import accept_websocket,require_websocket</code></p><h2 id="命令整合"><a class="anchor" href="#命令整合">#</a> 命令整合</h2><p>由于该项目涉及到的软件多，需要同时 / 相继运行多个命令，故写了 bat 批处理文件统筹运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">echo Preparing system</span><br><span class="line">echo off    </span><br><span class="line">rmdir /q /s %ZOOKEEPER_LOGS_PATH%</span><br><span class="line">rmdir /q /s %KAFKA_LOGS_PATH%</span><br><span class="line">timeout 1</span><br><span class="line">echo Starting Zookeeper</span><br><span class="line">start cmd /k %KAFKA_PATH%\bin\windows\zookeeper-server-start.bat %KAFKA_PATH%\config\zookeeper.properties</span><br><span class="line">timeout 5</span><br><span class="line">echo Starting Kafka Server</span><br><span class="line">start cmd /k %KAFKA_PATH%\bin\windows\kafka-server-start.bat %KAFKA_PATH%\config\server.properties</span><br><span class="line">timeout 5</span><br><span class="line">echo Starting Kafka Producer</span><br><span class="line">start cmd /k %ANACONDA_PATH%/python.exe %THIS_PATH%/kafka/realTimeDataCollector.py /k</span><br><span class="line">timeout 1</span><br><span class="line">echo Starting Spark as Consumer</span><br><span class="line">start cmd /k %ANACONDA_PATH%/python.exe %THIS_PATH%/trading-bot-master/eval.py /trading-bot-master/data/train.csv --model-name model_double-dqn_GOOG_50 --debug  </span><br><span class="line"></span><br><span class="line">echo Starting web server</span><br><span class="line">start cmd /k %ANACONDA_PATH%/python.exe %THIS_PATH%/server/manage.py runserver</span><br></pre></td></tr></table></figure><p>为了促进一点点代码健壮性和可复用性，乐。也写了配置文件统一修改参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">        <span class="comment"># crypto setup</span></span><br><span class="line">        <span class="string">&#x27;currency_1&#x27;</span>: <span class="string">&#x27;BTC&#x27;</span>, <span class="comment"># bitcoin</span></span><br><span class="line">        <span class="string">&#x27;currency_2&#x27;</span>: <span class="string">&#x27;ETH&#x27;</span>, <span class="comment"># ethereum</span></span><br><span class="line">        <span class="string">&#x27;currency_3&#x27;</span>: <span class="string">&#x27;LINK&#x27;</span>, <span class="comment"># chainlink</span></span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">&#x27;kafka_broker&#x27;</span>: <span class="string">&#x27;localhost:9092&#x27;</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="结果可视化"><a class="anchor" href="#结果可视化">#</a> 结果可视化</h1><p>为了展示数据，我们设计了一个网站来展示一些图表和信息。</p><ol><li>设置了几个旋转卡片来显示不同加密货币的信息。卡片的正面显示了加密货币的名称、实时价格和相应的时间点。背面是相应加密货币的介绍和网址链接。信息以秒为单位进行更新。更新速度和加密货币的数量可以调整。</li></ol><p><img data-src="/assets/stream_processing/cards.png" alt="cards" title="旋转卡片"></p><ol start="2"><li>使用折线图显示强化学习模型的预测结果。x 轴表示对应的时间 (分 - 秒)。y 轴表示某种加密货币的实时值。由于我们输入的是窗口实时价格，它会根据概率计算输出下一个时间间隔的最佳动作，并给用户一些建议。一旦有下降的趋势，将会出现红色标志表示警告，提示卖出，而绿色标志这表示价格良好，可以买入。图像也以秒为单位进行更新。</li></ol><p><img data-src="/assets/stream_processing/graph.png" alt="graph" title="预测折线图"></p><ol start="3"><li>使用 Tradingview API 在页面中嵌入了一个 JavaScript 应用程序，以显示有关许多加密货币的更多信息。实现更多的功能。</li></ol><p><img data-src="/assets/stream_processing/tradingview.png" alt="tradingview" title="Tradingview API" height="40%"></p><p>以下是 demo 视频展示</p><div class="media-container"><div class="player" data-type="video" data-src='[{"name":"demo","url":"/assets/stream_processing/demo.mp4"}]'></div></div><p>由于要快速传输实时数据，因此前端和后端之间的响应交互必须及时。因此，WebSocket 被用来解决这个问题。</p><p><img data-src="/assets/stream_processing/websocket.png" alt="websocket" title="中间件"></p><figure class="highlight javascript"><figcaption><span>中间件websocket</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断浏览器是否支持WebSocket，目前应该所有的浏览器都支持了.....</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;WebSocket&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;你的浏览器支持 WebSocket&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建一个WebSocket对象：sk，并且建立与服务端的连接（服务端程序要跑着哦）</span></span><br><span class="line"><span class="keyword">var</span> sk = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://&#x27;</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span> + <span class="string">&#x27;/test/&#x27;</span>);</span><br><span class="line"><span class="comment">// 向服务端发送消息</span></span><br><span class="line">sk.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;websocket connection successful...&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> l = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>];</span><br><span class="line">    sk.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(l));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 接收服务端的消息，主要的业务逻辑也在这里完成</span></span><br><span class="line">sk.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="comment">// 业务逻辑</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;from service message: &#x27;, msg.data);</span></span><br><span class="line">    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(msg.<span class="property">data</span>.<span class="title function_">replace</span>(<span class="regexp">/\&#x27;/g</span>, <span class="string">&#x27;&quot;&#x27;</span>));</span><br><span class="line">    $(<span class="string">&quot;#BTC_currency&quot;</span>).<span class="title function_">html</span>(data[<span class="string">&quot;topic_BTC&quot;</span>][<span class="string">&quot;currency&quot;</span>])</span><br><span class="line">    $(<span class="string">&quot;#BTC_amount&quot;</span>).<span class="title function_">html</span>(data[<span class="string">&quot;topic_BTC&quot;</span>][<span class="string">&quot;amount&quot;</span>])</span><br><span class="line">    $(<span class="string">&quot;#BTC_time&quot;</span>).<span class="title function_">html</span>(<span class="title function_">timestampToTime</span>(data[<span class="string">&quot;topic_BTC&quot;</span>][<span class="string">&quot;time&quot;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;from service message: &#x27;</span>, msg.<span class="property">data</span>);</span><br><span class="line">    <span class="comment">// 由于服务端主动断开连接，这里也断开WebSocket连接</span></span><br><span class="line">    <span class="keyword">if</span> (sk.<span class="property">readyState</span> == <span class="title class_">WebSocket</span>.<span class="property">CLOSED</span>) sk.<span class="title function_">close</span>();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 完事就关闭WebSocket连接</span></span><br><span class="line">sk.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;websocket connection close...&#x27;</span>);</span><br><span class="line">    sk.<span class="title function_">close</span>()</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 当WebSocket连接创建成功后，我们就可以向服务端发送数据了</span></span><br><span class="line"><span class="keyword">if</span> (sk.<span class="property">readyState</span> == <span class="title class_">WebSocket</span>.<span class="property">OPEN</span>) sk.<span class="title function_">onopen</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="还能做的一些事情"><a class="anchor" href="#还能做的一些事情">#</a> 还能做的一些事情</h1><ol><li><p>可以将所有的强化学习操作将被移植到 Spark Streaming。利用 Keras API 和 Spark MLlib，我们可以更好的去实现 ransform, pipelines and featurization，完全以 Streaming 的形式实现预测功能。</p></li><li><p>可以使用其他工具来更好地在 Spark 中呈现模型。例如，Analytics Zoo 是一个在 Spark 上运行 TensorFlow 的平台。与基础设施、Spark 数据结构和管道集成。BigDL 是一个开源的分布式深度学习框架。从而实现分布式模型训练和评估。</p></li><li><p>虽然我们尝试用 Kafka 和 Spark 来重现整个管道过程，但是分布式属性，这个最大的优势和特点，并没有表现出来。原因主要是我们只在一台计算机上部署应用程序。</p><p>为了实现分布式的想法，在云平台托管应用程序将是一个不错的选择。在此之前，Docker 可以设置一个容器来打包应用程序。Kubernetes 更好。它可以管理一堆主机和节点。在每个节点中，它运行许多独立的 pod (容器集)，这些 pod 可以实现我们应用程序的组件，如数据库，网站服务器。</p><p>一旦我们将 Kubernetes 部署在某个平台上，比如 Amazon EKS 或 Google GKE，它就可以创建一个集群来组织我们设置的所有节点，并构建一个控制面板来管理它们。在一定程度上实现了分布式特性。</p><p>节点可以执行不同的指令。例如，不同节点可以异步处理不同类型的加密货币，从而减少数据更新的延迟。</p><p>另一方面，多个节点可以继续运行训练过程，并通过实时性持续优化模型的性能。在不影响前端网页正常使用的情况下，逐步更换旧模型。</p><p>当任何其他用户想要查看特定加密货币的预测结果时，特定的主机会提供相应的结果。Kafka 的分区配置也可以在多个节点中使用。</p></li></ol><div class="tags"><a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="ic i-tag"></i> 强化学习</a> <a href="/tags/%E6%B5%81%E5%A4%84%E7%90%86/" rel="tag"><i class="ic i-tag"></i> 流处理</a> <a href="/tags/Kafka/" rel="tag"><i class="ic i-tag"></i> Kafka</a> <a href="/tags/Zookeeper/" rel="tag"><i class="ic i-tag"></i> Zookeeper</a> <a href="/tags/Spark/" rel="tag"><i class="ic i-tag"></i> Spark</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-03-19 20:39:22" itemprop="dateModified" datetime="2024-03-19T20:39:22+08:00">2024-03-19</time> </span><span id="projects/stream_processing/" class="item leancloud_visitors" data-flag-title="用深度强化学习实时预测和交易加密货币" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="Miralce 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.jpg" alt="Miralce 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Miralce <i class="ic i-at"><em>@</em></i>自是白衣卿相的博客</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/projects/stream_processing/" title="用深度强化学习实时预测和交易加密货币">http://example.com/projects/stream_processing/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/projects/double_descent/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;MiracleLinzzz.github.io&#x2F;picx-images-hosting&#x2F;DSCF9245.42ll7bij8sg0.webp" title="探究不同场景下的双下降(Double Descent)现象"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 科研项目</span><h3>探究不同场景下的双下降(Double Descent)现象</h3></a></div><div class="item right"><a href="/projects/punch_go/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;MiracleLinzzz.github.io&#x2F;picx-images-hosting&#x2F;DSCF9318.5bk8leyb8mg0.webp" title="基于以太坊的『Punch Go』去中心化应用(DAPP)"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 科研项目</span><h3>基于以太坊的『Punch Go』去中心化应用(DAPP)</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D-%E7%9E%8E%E9%B8%A1%E5%84%BF%E5%87%91%E5%AD%97%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">背景介绍 (瞎鸡儿凑字数)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.1.</span> <span class="toc-text">为什么要用强化学习？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E6%B5%81%E5%A4%84%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">为什么要用流处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">强化学习模型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E5%A4%84%E7%90%86%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">流处理操作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%87%86%E5%A4%87"><span class="toc-number">3.1.</span> <span class="toc-text">环境配置准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E5%A4%84%E7%90%86%E8%BD%AF%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.2.</span> <span class="toc-text">流处理软件初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%8B%AC%E6%90%AD%E5%BB%BA-zookeeper-%E7%8E%AF%E5%A2%83%E5%B9%B6%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.1.</span> <span class="toc-text">单独搭建 ZooKeeper 环境并启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDkafka"><span class="toc-number">3.2.2.</span> <span class="toc-text">下载 Kafka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8kafka%E5%86%85%E7%BD%AE%E7%9A%84zookeeper%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.3.</span> <span class="toc-text">启动 Kafka 内置的 ZooKeeper 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8kafka"><span class="toc-number">3.2.4.</span> <span class="toc-text">启动 Kafka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spark-dstream-%E6%B5%81%E5%A4%84%E7%90%86"><span class="toc-number">3.2.5.</span> <span class="toc-text">Spark Dstream 流处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%95%B4%E5%90%88"><span class="toc-number">3.3.</span> <span class="toc-text">命令整合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">结果可视化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%98%E8%83%BD%E5%81%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BA%8B%E6%83%85"><span class="toc-number">5.</span> <span class="toc-text">还能做的一些事情</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/projects/stream_processing/" rel="bookmark" title="用深度强化学习实时预测和交易加密货币">用深度强化学习实时预测和交易加密货币</a></li><li><a href="/projects/double_descent/" rel="bookmark" title="探究不同场景下的双下降(Double Descent)现象">探究不同场景下的双下降(Double Descent)现象</a></li><li><a href="/projects/punch_go/" rel="bookmark" title="基于以太坊的『Punch Go』去中心化应用(DAPP)">基于以太坊的『Punch Go』去中心化应用(DAPP)</a></li><li><a href="/projects/alzheimer/" rel="bookmark" title="Alzheimer’s Disease Detection using Disfluencies Implemented Fine-Tuning BERT Model Ensemble">Alzheimer’s Disease Detection using Disfluencies Implemented Fine-Tuning BERT Model Ensemble</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Miralce" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Miralce</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">8</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">12</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL01pcmFjbGVMaW56eno=" title="https:&#x2F;&#x2F;github.com&#x2F;MiracleLinzzz"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnl1bmhhbmcubGluQGNvbHVtYmlhLmVkdQ==" title="mailto:yunhang.lin@columbia.edu"><i class="ic i-envelope"></i></span> <span class="exturl item linkedin" data-url="aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL3l1bmhhbmdsaW4v" title="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;yunhanglin&#x2F;"><i class="ic i-linkedin"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjg3MDU1OTcz" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;287055973"><i class="ic i-bilibili"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQHl1bmhhbmdsaW4xNzc4" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;@yunhanglin1778"><i class="ic i-youtube"></i></span> <span class="exturl item xiaohongshu" data-url="aHR0cHM6Ly93d3cueGlhb2hvbmdzaHUuY29tL3VzZXIvcHJvZmlsZS81YmI4NTg0ZjQ1YzZlODAwMDFmMDhiNjc=" title="https:&#x2F;&#x2F;www.xiaohongshu.com&#x2F;user&#x2F;profile&#x2F;5bb8584f45c6e80001f08b67"><i class="ic i-xiaohongshu"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>文章</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/projects/double_descent/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/projects/punch_go/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/projects/" title="分类于 科研项目">科研项目</a></div><span><a href="/projects/double_descent/" title="探究不同场景下的双下降(Double Descent)现象">探究不同场景下的双下降(Double Descent)现象</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/neural-network/" title="分类于 神经网络">神经网络</a></div><span><a href="/neural_network/transformer/" title="Transformer 备忘录">Transformer 备忘录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/projects/" title="分类于 科研项目">科研项目</a></div><span><a href="/projects/alzheimer/" title="Alzheimer’s Disease Detection using Disfluencies Implemented Fine-Tuning BERT Model Ensemble">Alzheimer’s Disease Detection using Disfluencies Implemented Fine-Tuning BERT Model Ensemble</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/projects/" title="分类于 科研项目">科研项目</a></div><span><a href="/projects/punch_go/" title="基于以太坊的『Punch Go』去中心化应用(DAPP)">基于以太坊的『Punch Go』去中心化应用(DAPP)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/travel/" title="分类于 旅行日志">旅行日志</a> <i class="ic i-angle-right"></i> <a href="/categories/travel/%E6%97%A5%E6%9C%AC%E8%B7%A8%E5%B9%B4%E8%A1%8C/" title="分类于 日本跨年行">日本跨年行</a></div><span><a href="/travel/japan/route/" title="15天9城特种兵行程总结">15天9城特种兵行程总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/projects/" title="分类于 科研项目">科研项目</a></div><span><a href="/projects/stream_processing/" title="用深度强化学习实时预测和交易加密货币">用深度强化学习实时预测和交易加密货币</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/travel/" title="分类于 旅行日志">旅行日志</a></div><span><a href="/travel/xinjiang/xinjiang/" title="跨越山海|新疆自驾毕业旅行">跨越山海|新疆自驾毕业旅行</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/travel/" title="分类于 旅行日志">旅行日志</a> <i class="ic i-angle-right"></i> <a href="/categories/travel/%E6%97%A5%E6%9C%AC%E8%B7%A8%E5%B9%B4%E8%A1%8C/" title="分类于 日本跨年行">日本跨年行</a></div><span><a href="/travel/japan/food/" title="日本行美食总结">日本行美食总结</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-Miracle"></i> </span><span class="author" itemprop="copyrightHolder">Miralce @ Miracle</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">31k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">28 分钟</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"projects/stream_processing/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>